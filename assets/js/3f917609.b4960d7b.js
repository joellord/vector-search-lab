"use strict";(self.webpackChunkswiftui_realm_app=self.webpackChunkswiftui_realm_app||[]).push([[726],{4137:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c=r.createContext({}),l=function(e){var t=r.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=l(e.components);return r.createElement(c.Provider,{value:t},e.children)},h="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,c=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),h=l(n),p=a,m=h["".concat(c,".").concat(p)]||h[p]||d[p]||o;return n?r.createElement(m,s(s({ref:t},u),{},{components:n})):r.createElement(m,s({ref:t},u))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,s=new Array(o);s[0]=p;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[h]="string"==typeof e?e:a,s[1]=i;for(var l=2;l<o;l++)s[l]=n[l];return r.createElement.apply(null,s)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},6446:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>s,default:()=>d,frontMatter:()=>o,metadata:()=>i,toc:()=>l});var r=n(7462),a=(n(7294),n(4137));const o={sidebar_position:7},s="\ud83e\uddb8 Better results with scoring",i={unversionedId:"atlas-search/scored",id:"atlas-search/scored",title:"\ud83e\uddb8 Better results with scoring",description:"In information retrieval, relevance scoring is a technique used to evaluate how closely a document matches a query. Atlas Search is built on Apache Lucene. Lucene utilizes a combination of the Vector Space Model (VSM) and the Boolean model to determine the relevance score of each search result. The VSM assesses the similarity between the query and the document, while the Boolean model determines if the document contains all the query terms. Based on these factors, Lucene assigns a score to each search result, indicating its relevance to the query.",source:"@site/docs/4-atlas-search/7-scored.mdx",sourceDirName:"4-atlas-search",slug:"/atlas-search/scored",permalink:"/vector-search-lab/docs/atlas-search/scored",draft:!1,editUrl:"https://github.com/joellord/vector-search-lab/blob/main/docs/4-atlas-search/7-scored.mdx",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"tutorialSidebar",previous:{title:"\ud83e\uddb8 Turbocharge your search with fuzzy matching",permalink:"/vector-search-lab/docs/atlas-search/fuzzy"},next:{title:"Vector Search",permalink:"/vector-search-lab/docs/category/vector-search"}},c={},l=[{value:"Add it to your application",id:"add-it-to-your-application",level:2}],u={toc:l},h="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(h,(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"-better-results-with-scoring"},"\ud83e\uddb8 Better results with scoring"),(0,a.kt)("p",null,"In information retrieval, relevance scoring is a technique used to evaluate how closely a document matches a query. Atlas Search is built on Apache Lucene. Lucene utilizes a combination of the Vector Space Model (VSM) and the Boolean model to determine the relevance score of each search result. The VSM assesses the similarity between the query and the document, while the Boolean model determines if the document contains all the query terms. Based on these factors, Lucene assigns a score to each search result, indicating its relevance to the query."),(0,a.kt)("admonition",{type:"tip"},(0,a.kt)("p",{parentName:"admonition"},"The aggregation that we used just now returns multiple documents. Among the results are the expected ",(0,a.kt)("inlineCode",{parentName:"p"},"Harry Potter")," but also ",(0,a.kt)("inlineCode",{parentName:"p"},"Dirty Harry"),", and more. All of these are one character away from ",(0,a.kt)("inlineCode",{parentName:"p"},"Hary"),"! To get the most popular movie showing up first in the results, you can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"function")," to alter the relevance score.")),(0,a.kt)("p",null,"You can see what's the score for each returned document by amending the ",(0,a.kt)("inlineCode",{parentName:"p"},"$project")," stage."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"Scroll down to ",(0,a.kt)("strong",{parentName:"li"},"Stage 2")," and add the following.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'  {\n    title: 1,\n    year: 1,\n    "imdb.rating": 1,\n    fullplot: 1,\n    poster: 1,\n    released: 1,\n    genres: 1,\n    score: { $meta: "searchScore" }\n  }\n')),(0,a.kt)("p",null,"On the right, you'll see the documents with the highest score first. You can also notice that the documents have the same score or a very close score. That's because all texts are 'one character away' from the query."),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("p",{parentName:"li"},"Scroll up to ",(0,a.kt)("strong",{parentName:"p"},"Stage 1")," and add a scoring function. Here, you're adding 10 points for every award the movie won to the relevance score."),(0,a.kt)("pre",{parentName:"li"},(0,a.kt)("code",{parentName:"pre",className:"language-js"},'{\n  index: "default",\n  text: {\n    query: "hary",\n    path: "title",\n    fuzzy: {\n        maxEdits: 1\n    },\n    score: {\n      function: {\n        add: [\n          { score: \'relevance\' },\n          { multiply: [{constant: 10}, { path: \'awards.wins\' }] }\n        ]\n      }\n    }\n  }\n}\n')))),(0,a.kt)("p",null,"You're modifying the default relevance score by using the ",(0,a.kt)("inlineCode",{parentName:"p"},"function")," option. The function calculates the score by adding the 10 points for every ",(0,a.kt)("inlineCode",{parentName:"p"},"awards.wins")," to the relevance score. That way, the movie with the highest ",(0,a.kt)("inlineCode",{parentName:"p"},"awards.wins")," value will rank first in the search results."),(0,a.kt)("h2",{id:"add-it-to-your-application"},"Add it to your application"),(0,a.kt)("p",null,"There is a method ready for you to use in the ",(0,a.kt)("inlineCode",{parentName:"p"},"server/controllers/movies.mjs")," file. Open up the file and find the ",(0,a.kt)("inlineCode",{parentName:"p"},"scoredSearch")," method. Replace the code with your new aggregation pipeline that will do fuzzy searching, and return the movies that won the most awards."),(0,a.kt)("details",null,(0,a.kt)("summary",null,"Answer"),(0,a.kt)("div",null,(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'  async scoredSearch(searchTerm) {\n    const movies = await collection\n      .aggregate([\n        {\n          $search: {\n            index: "default",\n            text: {\n              query: searchTerm,\n              path: "title",\n              fuzzy: {\n                  maxEdits: 1\n              },\n              score: {\n                function: {\n                  add: [\n                    {multiply: [\n                      { path: \'awards.wins\' },\n                      { constant: 10 },\n\n                    ]},\n                    { score: \'relevance\' }\n                  ]\n                }\n              }\n            }\n          }\n        },\n        {\n          $project: {\n            title: 1,\n            year: 1,\n            "imdb.rating": 1,\n            fullplot: 1,\n            poster: 1,\n            released: 1,\n            genres: 1,\n            score: { $meta: "searchScore" }\n          }\n        }\n      ]).toArray();\n\n    return movies;\n  }\n')))))}d.isMDXComponent=!0}}]);